{% extends 'books/base.html' %}

{% block title %}–ö–∞—Ç–∞–ª–æ–≥ –∫–Ω–∏–≥ - Librio{% endblock %}

{% block content %}
<h1>–ö–∞—Ç–∞–ª–æ–≥ –∫–Ω–∏–≥</h1>

<div class="card mb-4">
    <div class="card-body">
        <form method="get" class="row g-3">
            <!-- –ü–æ–∏—Å–∫ -->
            <div class="col-md-4">
                <input type="text" name="search" class="form-control"
                       placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é, –∞–≤—Ç–æ—Ä—É, –∂–∞–Ω—Ä—É..."
                       value="{{ search_query }}">
            </div>

            <div class="col-md-3">
                <select name="genre" class="form-select">
                    <option value="">–í—Å–µ –∂–∞–Ω—Ä—ã</option>
                    {% for genre in genres %}
                    <option value="{{ genre.name }}"
                            {% if genre_filter == genre.name %}selected{% endif %}>
                        {{ genre.name }}
                    </option>
                    {% endfor %}
                </select>
            </div>

            <div class="col-md-3">
                <select name="availability" class="form-select">
                    <option value="">–í—Å–µ –∫–Ω–∏–≥–∏</option>
                    <option value="available"
                            {% if availability_filter =='available' %}selected{% endif %}>
                        üìö –î–æ—Å—Ç—É–ø–Ω—ã–µ
                    </option>
                    <option value="unavailable"
                            {% if availability_filter =='unavailable' %}selected{% endif %}>
                        ‚è≥ –í—ã–¥–∞–Ω–Ω—ã–µ
                    </option>
                </select>
            </div>

            <div class="col-md-2">
                <button type="submit" class="btn btn-primary w-100">üîç –ù–∞–π—Ç–∏</button>
            </div>
        </form>

        {% if search_query or genre_filter or availability_filter %}
        <div class="mt-3">
            <a href="{% url 'book_list' %}" class="btn btn-outline-secondary btn-sm">
                ‚ùå –°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
            </a>
            <small class="text-muted ms-2">
                –ù–∞–π–¥–µ–Ω–æ –∫–Ω–∏–≥: {{ books.count }}
            </small>
        </div>
        {% endif %}
    </div>
</div>

<div class="row">
    {% for book in books %}
    <div class="col-md-6 mb-4">
        <div class="card h-100">
            <div class="card-body">
                <h5 class="card-title">{{ book.title }}</h5>
                <p class="card-text">
                    <strong>üë§ –ê–≤—Ç–æ—Ä:</strong> {{ book.author.full_name }}<br>
                    <strong>üìñ –ñ–∞–Ω—Ä:</strong> {{ book.genre.name }}<br>

                    {% if book.access_level != 'free' %}
                    <strong>üîí –£—Ä–æ–≤–µ–Ω—å –¥–æ—Å—Ç—É–ø–∞:</strong>
                    <span class="badge
                        {% if book.access_level == 'student' %}bg-warning
                        {% elif book.access_level == 'premium' %}bg-info
                        {% elif book.access_level == 'restricted' %}bg-danger
                        {% else %}bg-secondary{% endif %}">
                        {{ book.get_access_level_display }}
                    </span><br>
                    {% endif %}

                    <strong>üìä –°—Ç–∞—Ç—É—Å:</strong>
                    {% if book.is_available %}
                        <span class="text-success">‚úÖ –î–æ—Å—Ç—É–ø–Ω–∞</span>
                    {% else %}
                        <span class="text-danger">‚è≥ –í—ã–¥–∞–Ω–∞</span>
                    {% endif %}
                </p>
            </div>

            <div class="card-footer">
                {% if book.is_available %}
                <a href="{% url 'borrow_book' book.id %}" class="btn btn-primary btn-sm">
                    üì• –í—ã–¥–∞—Ç—å –∫–Ω–∏–≥—É
                </a>
                {% else %}
                <span class="btn btn-secondary btn-sm disabled">
                    üîí –ù–µ–¥–æ—Å—Ç—É–ø–Ω–∞
                </span>
                {% endif %}

                <small class="text-muted ms-2">
                    {% if book.max_loan_days %}
                    –°—Ä–æ–∫: {{ book.max_loan_days }} –¥–Ω.
                    {% endif %}
                </small>
            </div>
        </div>
    </div>
    {% empty %}
    <div class="col-12">
        <div class="alert alert-info text-center">
            <h4>üìö –ö–Ω–∏–≥–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h4>
            <p>
                {% if search_query or genre_filter or availability_filter %}
                –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞ –∏–ª–∏
                <a href="{% url 'book_list' %}">—Å–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</a>
                {% else %}
                –í –±–∏–±–ª–∏–æ—Ç–µ–∫–µ –ø–æ–∫–∞ –Ω–µ—Ç –∫–Ω–∏–≥.
                <a href="{% url 'admin:books_book_add' %}">–î–æ–±–∞–≤—å—Ç–µ –∫–Ω–∏–≥–∏ —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω–∫—É</a>
                {% endif %}
            </p>
        </div>
    </div>
    {% endfor %}
</div>

{% if books.count > 10 %}
<nav aria-label="Page navigation" class="mt-4">
    <ul class="pagination justify-content-center">
        <li class="page-item disabled">
            <a class="page-link" href="#">–ü—Ä–µ–¥—ã–¥—É—â–∞—è</a>
        </li>
        <li class="page-item active"><a class="page-link" href="#">1</a></li>
        <li class="page-item"><a class="page-link" href="#">2</a></li>
        <li class="page-item"><a class="page-link" href="#">3</a></li>
        <li class="page-item">
            <a class="page-link" href="#">–°–ª–µ–¥—É—é—â–∞—è</a>
        </li>
    </ul>
</nav>
{% endif %}
{% endblock %}